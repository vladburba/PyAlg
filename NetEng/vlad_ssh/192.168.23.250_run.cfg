Building configuration...


Current configuration : 16692 bytes
!
version 12.4
service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
service password-encryption
!
hostname fas-msk-rt1
!
boot-start-marker
boot-end-marker
!
logging message-counter syslog
logging buffered 65536
enable secret 5 $1$oXgI$fBMPGRbSQ2hYtNEPv8B1T/
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local 
!
!
aaa session-id common
clock timezone MSK 3
dot11 syslog
ip source-route
!
!
ip dhcp database DHCP1
ip dhcp excluded-address 10.80.23.100 10.80.23.254
ip dhcp excluded-address 10.80.23.1 10.80.23.10
ip dhcp excluded-address 10.85.23.100 10.85.23.254
!
ip dhcp pool Phone
   network 10.80.23.0 255.255.255.0
   option 150 ip 10.80.50.11 
   default-router 10.80.23.250 
!
ip dhcp pool LocalInet
   network 10.85.23.0 255.255.255.0
   default-router 10.85.23.250 
   dns-server 8.8.8.8 
!
!
ip cef
no ip domain lookup
ip domain name wcfc.local
ip inspect name FW_Local_Inet tcp
ip inspect name FW_Local_Inet udp
ip inspect name FW_Local_Inet icmp
no ipv6 cef
ntp server 192.168.50.250
ntp server 192.168.128.250
!
multilink bundle-name authenticated
!
!
!
!
!
!
key chain Eigrp_pass
 key 1
   key-string 7 0222296459565E7573581917
!
!
voice service voip 
 allow-connections h323 to h323
 allow-connections h323 to sip
 allow-connections sip to h323
 allow-connections sip to sip
 redirect ip2ip
 fax protocol cisco 
 sip
!
!
!
voice class codec 101
 codec preference 1 g711ulaw
!
!
!
!
!
!
!
!
!
!
!
!
!
!
voice-card 0
!
!
!
!
!
username serg privilege 15 secret 5 $1$5apJ$wkiXgIsQWl2uXBLt/ODhD1
username vlad privilege 15 secret 5 $1$sfAD$Z7CEpAghy5iMCDEmdBteY1
username kost privilege 15 secret 5 $1$lcdi$KK.aE4eBJUnmTkN61PVkN0
archive
 log config
  hidekeys
! 
!
crypto isakmp policy 10
 encr aes 256
 authentication pre-share
 group 5
 lifetime 3600
crypto isakmp key idapi32.cfg address 0.0.0.0 0.0.0.0
crypto isakmp keepalive 10 periodic
!
crypto ipsec security-association idle-time 60
!
crypto ipsec transform-set AES-256 esp-aes 256 esp-sha-hmac 
!
crypto ipsec profile DMVPN-1
 set transform-set AES-256 
!
crypto ipsec profile DMVPN-2
 set transform-set AES-256 
!
!
!
!
ip tftp source-interface FastEthernet0/0.80
!
track 10 list threshold percentage
 object 11
 object 12
 threshold percentage up 50
!
track 11 ip sla 11 reachability
 default-state up
 delay down 180 up 30
!
track 12 ip sla 12 reachability
 default-state up
 delay down 180 up 30
!
track 21 ip sla 21 reachability
 default-state up
 delay down 30 up 180
!
track 22 ip sla 22 reachability
 default-state up
 delay down 30 up 180
!
class-map match-any MANAGEMENT
 match protocol telnet
 match protocol ssh
 match protocol snmp
class-map match-any VOICE
 match protocol mgcp
 match protocol skinny
 match protocol sip
class-map match-any RTP
 match protocol rtp
class-map match-any NETWORK-CRITICAL
 match access-group name ISAKMP
!
!
policy-map WAN
 class VOICE
    priority 50
 class RTP
    priority 500
 class MANAGEMENT
    priority 500
 class NETWORK-CRITICAL
    priority 500
 class class-default
     random-detect
policy-map WAN-INTERFACE-F0/1
 class class-default
    shape average 3000000
  service-policy WAN
!
!
!
!
!
interface Tunnel11
 bandwidth 4000
 ip address 10.10.10.23 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas1
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.10.10.50 95.163.126.10
 ip nhrp network-id 111
 ip nhrp holdtime 300
 ip nhrp nhs 10.10.10.50
 ip nhrp registration no-unique
 ip tcp adjust-mss 1260
 delay 10000
 tunnel source FastEthernet0/1
 tunnel mode gre multipoint
 tunnel key 111
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel12
 bandwidth 4000
 ip address 10.20.20.23 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas2
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.20.20.50 89.188.102.142
 ip nhrp network-id 222
 ip nhrp holdtime 300
 ip nhrp nhs 10.20.20.50
 ip nhrp registration no-unique
 ip tcp adjust-mss 1260
 delay 20000
 tunnel source FastEthernet0/1
 tunnel mode gre multipoint
 tunnel key 222
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel21
 bandwidth 4000
 ip address 10.30.30.23 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas3
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.30.30.50 95.163.126.10
 ip nhrp network-id 333
 ip nhrp holdtime 300
 ip nhrp nhs 10.30.30.50
 ip nhrp registration no-unique
 ip tcp adjust-mss 1260
 delay 30000
 shutdown
 tunnel source FastEthernet0/0.20
 tunnel mode gre multipoint
 tunnel key 333
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface Tunnel22
 bandwidth 4000
 ip address 10.40.40.23 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas4
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.40.40.50 89.188.102.142
 ip nhrp network-id 444
 ip nhrp holdtime 300
 ip nhrp nhs 10.40.40.50
 ip nhrp registration no-unique
 ip tcp adjust-mss 1260
 delay 40000
 shutdown
 tunnel source FastEthernet0/0.20
 tunnel mode gre multipoint
 tunnel key 444
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface FastEthernet0/0
 description INTERNAL
 no ip address
 speed 100
 full-duplex
!
interface FastEthernet0/0.20
 description Megafon_4G
 encapsulation dot1Q 20
 ip address 10.100.23.2 255.255.255.0
 ip access-group ACL-INET-PUBLIC in
 ip inspect FW_Local_Inet out
 ip virtual-reassembly
!
interface FastEthernet0/0.40
 description LAN
 encapsulation dot1Q 40
 ip address 192.168.23.250 255.255.255.0
 ip policy route-map Ent_Inet
!
interface FastEthernet0/0.50
 description partnet
 encapsulation dot1Q 50
 ip address 172.16.5.81 255.255.255.240
 ip access-group PARTNET in
!
interface FastEthernet0/0.80
 description VoIP
 encapsulation dot1Q 80
 ip address 10.80.23.250 255.255.255.0
!
interface FastEthernet0/0.85
 description Local_Inet
 encapsulation dot1Q 85
 ip address 10.85.23.250 255.255.255.0
 ip access-group Out_Local_Inet in
 ip nat inside
 ip virtual-reassembly
!
interface FastEthernet0/1
 description GorCom
 ip address dhcp
 ip access-group ACL-INET-PUBLIC in
 ip nat outside
 ip inspect FW_Local_Inet out
 ip virtual-reassembly
 speed 100
 full-duplex
!
router eigrp 1
 passive-interface default
 no passive-interface Tunnel11
 no passive-interface Tunnel12
 no passive-interface Tunnel21
 no passive-interface Tunnel22
 network 10.10.10.0 0.0.0.255
 network 10.20.20.0 0.0.0.255
 network 10.30.30.0 0.0.0.255
 network 10.40.40.0 0.0.0.255
 network 10.80.23.0 0.0.0.255
 network 10.85.23.0 0.0.0.255
 network 192.168.23.0
 no auto-summary
 eigrp stub connected summary
!
ip forward-protocol nd
ip route 0.0.0.0 0.0.0.0 FastEthernet0/1 46.39.246.1 10 name GorCom track 10
ip route 0.0.0.0 0.0.0.0 FastEthernet0/0.20 10.100.23.1 20 name 4G_backup
ip route 89.188.102.132 255.255.255.255 FastEthernet0/0.20 10.100.23.1 10 name Tun_22_UP
ip route 89.188.102.132 255.255.255.255 Null0 254 name Tun_22_DOWN
ip route 89.188.102.134 255.255.255.255 FastEthernet0/0.20 10.100.23.1
ip route 89.188.102.141 255.255.255.255 FastEthernet0/1 46.39.246.1 10 name Tun_12_UP
ip route 89.188.102.141 255.255.255.255 Null0 254 name Tun_12_DOWN
ip route 95.163.126.11 255.255.255.255 FastEthernet0/1 46.39.246.1 10 name Tun_11_UP
ip route 95.163.126.11 255.255.255.255 Null0 254 name Tun_11_DOWN
ip route 95.163.126.12 255.255.255.255 FastEthernet0/0.20 10.100.23.1 10 name Tun_21_UP
ip route 95.163.126.12 255.255.255.255 Null0 254 name Tun_21_DOWN
no ip http server
no ip http secure-server
!
!
no ip nat service sip udp port 5060
ip nat inside source list Nat_Local_Inet interface FastEthernet0/1 overload
!
ip access-list extended ACL-INET-PUBLIC
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
 permit icmp any any echo-reply
 permit icmp any any ttl-exceeded
 permit ip host 195.128.55.100 any
 permit ip host 89.207.94.167 any
 permit ip host 195.128.55.78 any
 permit ip host 195.128.55.105 any
 permit udp any any eq bootps
 permit udp any any eq bootpc
 permit ip host 62.76.13.129 any
 permit ip host 185.79.237.102 any
ip access-list extended Ent_Inet
 deny   ip any 10.0.0.0 0.255.255.255
 deny   ip any 172.16.0.0 0.15.255.255
 deny   ip any 192.168.0.0 0.0.255.255
 permit ip any any
ip access-list extended Nat_Local_Inet
 permit ip 10.85.0.0 0.0.255.255 any
ip access-list extended Out_Local_Inet
 permit ip host 10.85.23.5 host 192.168.129.120
 permit ip host 10.85.23.6 host 192.168.129.120
 permit ip host 10.85.23.7 host 192.168.129.120
 permit ip host 10.85.23.6 host 192.168.23.226
 permit ip host 10.85.23.6 host 192.168.23.228
 permit ip host 10.85.23.6 host 192.168.23.232
 permit ip host 10.85.23.5 host 192.168.128.139
 permit ip host 10.85.23.5 host 192.168.128.128
 permit ip host 10.85.23.6 host 192.168.128.139
 permit ip host 10.85.23.7 host 192.168.128.139
 deny   ip 10.85.0.0 0.0.255.255 10.0.0.0 0.255.255.255
 deny   ip 10.85.0.0 0.0.255.255 172.16.0.0 0.0.31.255
 deny   ip 10.85.0.0 0.0.255.255 192.168.0.0 0.0.255.255
 permit udp any any eq bootps
 permit ip 10.85.0.0 0.0.255.255 any
!
ip sla 11
 icmp-echo 95.163.126.11 source-interface FastEthernet0/1
 request-data-size 1000
 timeout 300
 threshold 200
 frequency 4
ip sla schedule 11 life forever start-time now
ip sla 12
 icmp-echo 89.188.102.141 source-interface FastEthernet0/1
 request-data-size 1000
 timeout 300
 threshold 200
 frequency 4
ip sla schedule 12 life forever start-time now
ip sla 21
 icmp-echo 95.163.126.12 source-interface FastEthernet0/0.20
 request-data-size 1000
 timeout 300
 threshold 200
 frequency 4
ip sla schedule 21 life forever start-time now
ip sla 22
 icmp-echo 89.188.102.132 source-interface FastEthernet0/0.20
 request-data-size 1000
 timeout 300
 threshold 200
 frequency 4
ip sla schedule 22 life forever start-time now
ip sla 25
 icmp-echo 10.80.50.11 source-ip 10.80.23.250
 request-data-size 256
 tos 30
 timeout 2000
 threshold 100
 owner OpManager
 frequency 5
ip sla schedule 25 life forever start-time now
ip sla 26
 path-echo 10.80.50.11 source-ip 10.80.23.250
 request-data-size 256
 tos 30
 threshold 100
 owner OpManager
 frequency 5
 paths-of-statistics-kept 2
 hops-of-statistics-kept 15
ip sla 43
 icmp-echo 89.188.102.132 source-ip 10.100.23.2
 request-data-size 256
 tos 30
 timeout 2000
 threshold 100
 owner OpManager
 frequency 5
ip sla schedule 43 life forever start-time now
ip sla 44
 path-echo 89.188.102.132 source-ip 10.100.23.2
 request-data-size 256
 tos 30
 threshold 100
 owner OpManager
 frequency 5
 paths-of-statistics-kept 2
 hops-of-statistics-kept 15
ip sla 93
 icmp-echo 95.163.126.11 source-ip 46.39.246.49
 request-data-size 256
 tos 30
 timeout 60000
 threshold 250
 owner OpManager
ip sla schedule 93 life forever start-time pending ageout 60
ip sla 95
 path-echo 95.163.126.11 source-ip 46.39.246.49
 request-data-size 256
 tos 30
 timeout 60000
 threshold 250
 owner OpManager
 paths-of-statistics-kept 2
 hops-of-statistics-kept 15
access-list 60 permit 192.168.50.128
access-list 60 permit 192.168.50.175
!
!
!
!
route-map Local_Inet permit 5
 match interface FastEthernet0/0.85
 set ip default next-hop 46.39.246.1
!
route-map Ent_Inet permit 10
 match ip address Ent_Inet
 set ip next-hop 10.10.10.50 10.20.20.50 10.30.30.50
 set ip default next-hop 10.40.40.50
!
!
snmp-server community c2011r RO 60
snmp-server community c2011w RW 60
snmp-server ifindex persist
snmp-server trap-source FastEthernet0/0.40
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps config
snmp-server enable traps syslog
snmp-server host 192.168.50.128 c2011w 
!
control-plane
!
!
!
voice-port 0/0/0
!
voice-port 0/0/1
!
voice-port 0/0/2
!
voice-port 0/0/3
!
!
mgcp fax t38 ecm
!
!
!
!
!
banner login ^CC
#######################################################
###               Attention!                        ###
###     RFG authorized personnel only.              ###
###     Please enter your username and password.    ###
###     All access will be logged.                  ###
#######################################################


^C
!
line con 0
 exec-timeout 60 0
line aux 0
line vty 0 4
 exec-timeout 60 0
 logging synchronous
 transport input ssh
line vty 5 15
 exec-timeout 60 0
 logging synchronous
 transport input ssh
!
scheduler allocate 20000 1000
event manager applet T11_up 
 event track 11 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 no shut"
 action 5.0 cli command "int tun21"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T12_up 
 event track 12 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 no shut"
 action 5.0 cli command "int tun22"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel22 shut"
event manager applet T12_down 
 event track 12 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 shut"
 action 5.0 track read 22
 action 6.0 if $_track_state eq up
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun22"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel22 no shut"
 action 9.3 end
event manager applet T11_down 
 event track 11 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 shut"
 action 5.0 track read 21
 action 6.0 if $_track_state eq up
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun21"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel21 no shut"
 action 9.3 end
event manager applet T22_up 
 event track 22 state up
 action 1.0 track read 12
 action 2.0 if $_track_state eq down
 action 3.0  cli command "en"
 action 4.0  cli command "conf t"
 action 5.0  cli command "int tun22"
 action 6.0  cli command "no shut"
 action 6.1  syslog priority emergencies msg "Tunnel22 no shut"
 action 7.0 end
event manager applet T22_down 
 event track 22 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun22"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel22 shut"
event manager applet T21_down 
 event tag tun21_down track 21 state down
 trigger
  correlate event tun21_down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun21"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "-= Tunnel21 shut =-"
 action 6.1 cli command "do clear ip nat translation forced"
 action 6.2 cli command "no ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/2 overload"
 action 6.3 cli command "ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/1 overload"
 action 6.4 cli command "interface GigabitEthernet0/0.85"
 action 6.5 cli command "no ip policy route-map Local_Inet"
event manager applet T21_up 
 event tag tun21_up track 21 state up
 trigger occurs 1 delay 5
  correlate event tun21_up
 action 0.1 cli command "en"
 action 0.2 cli command "conf t"
 action 0.3 cli command "do clear ip nat translation forced"
 action 0.4 cli command "no ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/1 overload"
 action 0.5 cli command "ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/2 overload"
 action 0.6 cli command "interface GigabitEthernet0/0.85"
 action 0.7 cli command "ip policy route-map Local_Inet"
 action 1.0 track read 11
 action 2.0 if $_track_state eq down
 action 3.0  cli command "int tun21"
 action 4.0  cli command "no shut"
 action 5.0  syslog priority emergencies msg "-= Tunnel21 no shut =-"
 action 7.0 end
!
end
