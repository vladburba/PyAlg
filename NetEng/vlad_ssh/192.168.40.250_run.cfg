Building configuration...


Current configuration : 17217 bytes
!
! Last configuration change at 16:08:19 MSK Tue Jun 30 2020 by vlad
! NVRAM config last updated at 16:10:15 MSK Tue Jun 30 2020 by vlad
!
version 16.3
service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
service password-encryption
no platform punt-keepalive disable-kernel-core
!
hostname kas-msk-rt1
!
boot-start-marker
boot system flash bootflash:isr4300-universalk9.16.03.04.SPA.bin
boot-end-marker
!
!
vrf definition Mgmt-intf
 !
 address-family ipv4
 exit-address-family
 !
 address-family ipv6
 exit-address-family
!
logging buffered 65536
logging console errors
enable secret 5 $1$oXgI$fBMPGRbSQ2hYtNEPv8B1T/
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local 
!
!
!
!
!
!
aaa session-id common
clock timezone MSK 3 0
!
!
!

no ip domain lookup
ip domain name wcfc.local
ip dhcp database Phone
ip dhcp excluded-address 10.80.40.100 10.80.40.254
ip dhcp excluded-address 10.80.40.1 10.80.40.10
ip dhcp excluded-address 10.84.40.245 10.84.40.255
!
ip dhcp pool Phone
 network 10.80.40.0 255.255.255.0
 option 150 ip 10.80.50.11 
 default-router 10.80.40.250 
!
ip dhcp pool Gym
 network 10.84.40.0 255.255.255.0
 default-router 10.84.40.250 
 dns-server 8.8.8.8 
!
ip dhcp pool Local_Inet
 network 10.85.40.0 255.255.255.0
 default-router 10.85.40.250 
 dns-server 8.8.8.8 
!
!
!
!
!
!
!
!
!
!
subscriber templating
!
!
!
multilink bundle-name authenticated
!
domain wcfc.local
!
!
!
!
key chain Eigrp_pass
 key 1
  key-string 7 0222296459565E7573581917
!
!
!
!
!
!
voice service voip
 allow-connections h323 to h323
 allow-connections h323 to sip
 allow-connections sip to h323
 allow-connections sip to sip
 redirect ip2ip
 fax protocol t38 version 0 ls-redundancy 0 hs-redundancy 0 fallback pass-through g711alaw
 sip
!
voice class codec 101
 codec preference 1 g711ulaw
!
!
!
!
!
!
!
!
!
voice-card 0/4
 no watchdog
!
license udi pid ISR4331/K9 sn FDO21290TBF
archive
 log config
  hidekeys
!
diagnostic bootup level minimal
spanning-tree extend system-id
!
!
username vlad privilege 15 secret 5 $1$sfAD$Z7CEpAghy5iMCDEmdBteY1
username serg privilege 15 secret 5 $1$5apJ$wkiXgIsQWl2uXBLt/ODhD1
username kost privilege 15 secret 5 $1$lcdi$KK.aE4eBJUnmTkN61PVkN0
!
redundancy
 mode none
!
!
!
!
!
!
track 10 list threshold percentage
 object 11
 object 12
 threshold percentage up 50
!
track 11 ip sla 11 reachability
 default-state up
 delay down 15 up 180
!
track 12 ip sla 12 reachability
 default-state up
 delay down 15 up 180
!
track 21 ip sla 21 reachability
 default-state up
 delay down 30 up 15
!
track 22 ip sla 22 reachability
 default-state up
 delay down 30 up 15
!
!
class-map match-any MANAGEMENT
 match protocol telnet
 match protocol ssh
 match protocol snmp
class-map type inspect match-any Out_Inside
 match access-group name Management_In
class-map type inspect match-any Inside_Out
 match access-group name Management_Out
 match protocol icmp
 match protocol tcp
 match protocol udp
class-map match-any VOICE
 match protocol mgcp
 match protocol skinny
 match protocol sip
class-map match-all RTP
 match protocol rtp
class-map type inspect match-any Self-Out
 match access-group name Management_Out
class-map type inspect match-any Out-Self
 match access-group name Management_In
class-map type inspect match-all INSIDE_Self
 match access-group name Self_and_INSIDE
!
policy-map type inspect Self_Out
 class type inspect Self-Out
  pass
 class class-default
policy-map Out-QoS
 class VOICE
  priority 16
 class RTP
  priority 1047
 class MANAGEMENT
  bandwidth 8
 class class-default
  fair-queue
  shape average 10000000   
policy-map type inspect Outside_Inside
 class type inspect Out_Inside
  pass
 class class-default
policy-map type inspect Inside_Outside
 class type inspect Inside_Out
  inspect
 class class-default
policy-map type inspect INSIDE_Self
 class type inspect INSIDE_Self
  inspect
 class class-default
policy-map type inspect Self_INSIDE
 class type inspect INSIDE_Self
  pass
 class class-default
policy-map type inspect Out_Self
 class type inspect Out-Self
  pass
 class class-default
!
zone security OUTSIDE
zone security INSIDE
zone-pair security INSIDE-TO-OUTSIDE source INSIDE destination OUTSIDE
 service-policy type inspect Inside_Outside
zone-pair security INSIDE_to_Self source INSIDE destination self
 service-policy type inspect INSIDE_Self
zone-pair security OUTSIDE-TO-INSIDE source OUTSIDE destination INSIDE
 service-policy type inspect Outside_Inside
zone-pair security Out-To-Self source OUTSIDE destination self
 service-policy type inspect Out_Self
zone-pair security Self-To-Out source self destination OUTSIDE
 service-policy type inspect Self_Out
zone-pair security Self_to_INSIDE source self destination INSIDE
 service-policy type inspect Self_INSIDE
! 
!
!
!
!
!
crypto isakmp policy 10
 encr aes 256
 authentication pre-share
 group 5
 lifetime 3600
crypto isakmp key idapi32.cfg address 0.0.0.0        
crypto isakmp keepalive 10 periodic
!
crypto ipsec security-association idle-time 60
!
crypto ipsec transform-set AES-256 esp-aes 256 esp-sha-hmac 
 mode tunnel
!
crypto ipsec profile DMVPN-1
 set transform-set AES-256 
!
crypto ipsec profile DMVPN-2
 set transform-set AES-256 
!
!
!
!
!
!
! 
! 
! 
! 
! 
! 
!
!
interface Tunnel11
 bandwidth 100000
 ip address 10.10.10.40 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas1
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.10.10.50 95.163.126.10
 ip nhrp network-id 111
 ip nhrp holdtime 300
 ip nhrp nhs 10.10.10.50
 ip tcp adjust-mss 1260
 delay 10000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 111
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel12
 bandwidth 100000
 ip address 10.20.20.40 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas2
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.20.20.50 89.188.102.142
 ip nhrp network-id 222
 ip nhrp holdtime 300
 ip nhrp nhs 10.20.20.50
 ip tcp adjust-mss 1260
 delay 20000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 222
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel21
 bandwidth 10000
 ip address 10.30.30.40 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas3
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.30.30.50 95.163.126.10
 ip nhrp network-id 333
 ip nhrp holdtime 300
 ip nhrp nhs 10.30.30.50
 ip tcp adjust-mss 1260
 delay 30000
 shutdown
 tunnel source GigabitEthernet0/0/2
 tunnel mode gre multipoint
 tunnel key 333
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface Tunnel22
 bandwidth 10000
 ip address 10.40.40.40 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas4
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.40.40.50 89.188.102.142
 ip nhrp network-id 444
 ip nhrp holdtime 300
 ip nhrp nhs 10.40.40.50
 ip tcp adjust-mss 1260
 delay 40000
 shutdown
 tunnel source GigabitEthernet0/0/2
 tunnel mode gre multipoint
 tunnel key 444
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface GigabitEthernet0/0/0
 description INTERNAL
 no ip address
 negotiation auto
!
interface GigabitEthernet0/0/0.40
 description LAN
 encapsulation dot1Q 40
 ip address 192.168.40.250 255.255.255.0
 ip policy route-map Ent_Inet
!
interface GigabitEthernet0/0/0.80
 description VoIP
 encapsulation dot1Q 80
 ip address 10.80.40.250 255.255.255.0
!
interface GigabitEthernet0/0/0.83
 description SCUD
 encapsulation dot1Q 83
 ip address 10.83.40.250 255.255.255.0
!
interface GigabitEthernet0/0/0.84
 description Gym
 encapsulation dot1Q 84
 ip address 10.84.40.250 255.255.255.0
 ip nat inside
 zone-member security INSIDE
 ip policy route-map NatPartNET
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.85
 description Local_Inet
 encapsulation dot1Q 85
 ip address 10.85.40.250 255.255.255.0
 ip nat inside
 ip access-group Out_Local_Inet in
 zone-member security INSIDE
 ip policy route-map NatPartNET
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.86
 description Videoreg
 encapsulation dot1Q 86
 ip address 10.86.40.250 255.255.255.0
!
interface GigabitEthernet0/0/1
 description IT_Group_Radio_Prime
 ip address 46.174.8.18 255.255.255.252
 ip nat outside
 zone-member security OUTSIDE
 negotiation auto
!
interface GigabitEthernet0/0/2
 description Obit_Optic_Back
 ip address 95.161.232.198 255.255.255.252
 ip nat outside
 zone-member security OUTSIDE
 negotiation auto
!
interface Service-Engine0/4/0
!
interface GigabitEthernet0
 vrf forwarding Mgmt-intf
 no ip address
 shutdown
 negotiation auto
!
!
router eigrp 1
 network 10.10.10.0 0.0.0.255
 network 10.20.20.0 0.0.0.255
 network 10.30.30.0 0.0.0.255
 network 10.40.40.0 0.0.0.255
 network 10.80.40.0 0.0.0.255
 network 10.83.40.0 0.0.0.255
 network 10.86.40.0 0.0.0.255
 network 192.168.40.0
 passive-interface default
 no passive-interface Tunnel11
 no passive-interface Tunnel12
 no passive-interface Tunnel21
 no passive-interface Tunnel22
 eigrp stub connected summary
!
ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/0/2 overload
ip forward-protocol nd
no ip http server
no ip http secure-server
ip tftp source-interface GigabitEthernet0/0/0.80
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/1 46.174.8.17 10 name ITGroup track 10
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/2 95.161.232.197 254 name Obit_back
ip route 89.188.102.132 255.255.255.255 GigabitEthernet0/0/2 95.161.232.197 10 name SLA_22_UP
ip route 89.188.102.141 255.255.255.255 GigabitEthernet0/0/1 46.174.8.17 10 name TUN12_UP
ip route 95.163.126.11 255.255.255.255 GigabitEthernet0/0/1 46.174.8.17 10 name TUN11_UP
ip route 95.163.126.12 255.255.255.255 GigabitEthernet0/0/2 95.161.232.197 10 name SLA_21_UP
!
!
ip access-list extended Ent_Inet
 deny   ip any 10.0.0.0 0.255.255.255
 deny   ip any 172.16.0.0 0.15.255.255
 deny   ip any 192.168.0.0 0.0.255.255
 permit ip any any
ip access-list extended Management_In
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
 permit ip host 89.207.94.167 any
 permit gre host 77.95.130.78 any
 permit ip host 185.79.237.102 any
 permit icmp any any
 permit ip host 89.207.94.135 any
 permit gre host 185.8.62.249 any
 permit ip host 185.8.62.249 any
 permit gre any any
 permit ip host 194.186.172.170 any
ip access-list extended Management_Out
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
 permit ip any host 89.207.94.167
 permit gre any host 77.95.130.78
 permit ip any host 185.79.237.102
 permit icmp any any
 permit gre any any
 permit gre any host 185.8.62.249
 permit ip any host 185.8.62.249
 permit ip host 89.207.94.135 any
 permit ip any host 194.186.172.170
ip access-list extended Nat_Local_Inet
 deny   ip 10.85.0.0 0.0.255.255 10.0.0.0 0.255.255.255
 deny   ip 10.85.0.0 0.0.255.255 172.16.0.0 0.0.31.255
 deny   ip 10.85.0.0 0.0.255.255 192.168.0.0 0.0.255.255
 permit ip 10.84.0.0 0.0.255.255 any log
 permit ip 10.85.0.0 0.0.255.255 any
 permit gre 10.85.0.0 0.0.255.255 any
ip access-list extended Out_Local_Inet
 deny   ip 10.85.0.0 0.0.255.255 10.0.0.0 0.255.255.255
 deny   ip 10.85.0.0 0.0.255.255 172.16.0.0 0.0.31.255
 deny   ip 10.85.0.0 0.0.255.255 192.168.0.0 0.0.255.255
 permit ip 10.85.0.0 0.0.255.255 any
 permit udp any any eq bootps
 permit gre 10.85.0.0 0.0.255.255 any
ip access-list extended Self_and_INSIDE
 permit ip any any
 permit gre any any
!
ip sla 11
 icmp-echo 95.163.126.11 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 11 life forever start-time now
ip sla 12
 icmp-echo 89.188.102.141 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 12 life forever start-time now
ip sla 21
 icmp-echo 95.163.126.12 source-interface GigabitEthernet0/0/2
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 21 life forever start-time now
ip sla 22
 icmp-echo 89.188.102.132 source-interface GigabitEthernet0/0/2
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 22 life forever start-time now
access-list 60 permit 192.168.50.128
access-list 60 permit 192.168.50.175
!
!
route-map NatPartNET permit 5
 match interface GigabitEthernet0/0/0.84 GigabitEthernet0/0/0.85
 set ip default next-hop 95.161.232.197
!
route-map Ent_Inet permit 10
 match ip address Ent_Inet
 set ip next-hop 10.10.10.50 10.20.20.50 10.30.30.50
 set ip default next-hop 10.40.40.50
!
snmp-server community c2011r RO 60
snmp-server community c2011w RW 60
snmp-server trap-source GigabitEthernet0/0/0.40
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps config
snmp-server enable traps syslog
snmp-server host 192.168.50.128 c2011w 
snmp ifmib ifindex persist
!
!
!
!
control-plane
!
 !
 !
 !
 !
!
mgcp behavior rsip-range tgcp-only
mgcp behavior comedia-role none
mgcp behavior comedia-check-media-src disable
mgcp behavior comedia-sdp-force disable
!
mgcp profile default
!
!
!
!
!
banner login ^CC
#######################################################
###               Attention!                        ###
###     RFG authorized personnel only.              ###
###     Please enter your username and password.    ###
###     All access will be logged.                  ###
#######################################################


^C
!
line con 0
 exec-timeout 60 0
 stopbits 1
line aux 0
 stopbits 1
line vty 0 4
 exec-timeout 60 0
 logging synchronous
 transport input ssh
line vty 5 15
 exec-timeout 60 0
 logging synchronous
 transport input ssh
!
ntp server 192.168.50.128
ntp server 10.100.50.14 prefer
!
!
!
!
event manager applet T11_up
 event track 11 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 no shut"
 action 5.0 cli command "int tun21"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T11_down
 event track 11 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 shut"
 action 5.0 track read 21
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun21"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel21 no shut"
 action 9.3 end
event manager applet T12_up
 event track 12 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 no shut"
 action 5.0 cli command "int tun22"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel22 shut"
event manager applet T12_down
 event track 12 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 shut"
 action 5.0 track read 22
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun22"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel22 no shut"
 action 9.3 end
event manager applet T21_up
 event track 21 state up
 action 1.0 track read 11
 action 2.0 if $_track_state eq "down"
 action 3.0  cli command "en"
 action 4.0  cli command "conf t"
 action 5.0  cli command "int tun21"
 action 6.0  cli command "no shut"
 action 6.1  syslog priority emergencies msg "Tunnel21 no shut"
 action 7.0 end
event manager applet T21_down
 event track 21 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun21"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T22_up
 event track 22 state up
 action 1.0 track read 12
 action 2.0 if $_track_state eq "down"
 action 3.0  cli command "en"
 action 4.0  cli command "conf t"
 action 5.0  cli command "int tun22"
 action 6.0  cli command "no shut"
 action 6.1  syslog priority emergencies msg "Tunnel22 no shut"
 action 7.0 end
event manager applet T22_down
 event track 22 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun22"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel22 shut"
!
end
