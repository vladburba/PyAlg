Building configuration...


Current configuration : 19089 bytes
!
! Last configuration change at 19:39:20 MSK Thu Jul 23 2020 by vlad
! NVRAM config last updated at 19:32:29 MSK Thu Jul 23 2020 by vlad
!
version 16.9
service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
service password-encryption
service unsupported-transceiver
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
!
hostname rec-msk-rt1
!
boot-start-marker
boot system flash isr4300-universalk9.16.09.05.SPA.bin
boot-end-marker
!
!
vrf definition Mgmt-intf
 !
 address-family ipv4
 exit-address-family
 !
 address-family ipv6
 exit-address-family
!
logging buffered 65536
enable secret 5 $1$oXgI$fBMPGRbSQ2hYtNEPv8B1T/
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local 
!
!
!
!
!
!
aaa session-id common
clock timezone MSK 3 0
!
no ip domain lookup
ip domain name wcfc.local
ip dhcp database Phone
ip dhcp excluded-address 10.80.45.1 10.80.45.20
ip dhcp excluded-address 10.83.45.1 10.83.45.20
ip dhcp excluded-address 10.84.45.1 10.84.45.20
ip dhcp excluded-address 10.85.45.1 10.85.45.20
ip dhcp excluded-address 10.80.45.245 10.80.45.255
ip dhcp excluded-address 10.83.45.245 10.83.45.255
ip dhcp excluded-address 10.84.45.245 10.84.45.255
ip dhcp excluded-address 10.85.45.245 10.85.45.255
!
ip dhcp pool Phone
 network 10.80.45.0 255.255.255.0
 option 150 ip 10.80.50.11 
 default-router 10.80.45.250 
!
ip dhcp pool Gym
 network 10.84.45.0 255.255.255.0
 default-router 10.84.45.250 
 dns-server 8.8.8.8 
!
ip dhcp pool Local_Inet
 network 10.85.45.0 255.255.255.0
 default-router 10.85.45.250 
 dns-server 8.8.8.8 
!
ip dhcp pool SCUD
 network 10.83.45.0 255.255.255.0
 default-router 10.83.45.250 
 dns-server 8.8.8.8 
!
!
!
login on-success log
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
!
multilink bundle-name authenticated
!
!
!
!
!
key chain Eigrp_pass
 key 1
  key-string 7 0222296459565E7573581917
!
!
crypto pki trustpoint TP-self-signed-2551376405
 enrollment selfsigned
 subject-name cn=IOS-Self-Signed-Certificate-2551376405
 revocation-check none
 rsakeypair TP-self-signed-2551376405
!
!
crypto pki certificate chain TP-self-signed-2551376405
 certificate self-signed 01
  30820330 30820218 A0030201 02020101 300D0609 2A864886 F70D0101 05050030 
  31312F30 2D060355 04031326 494F532D 53656C66 2D536967 6E65642D 43657274 
  69666963 6174652D 32353531 33373634 3035301E 170D3139 31313038 30383134 
  35395A17 0D323030 31303130 30303030 305A3031 312F302D 06035504 03132649 
  4F532D53 656C662D 5369676E 65642D43 65727469 66696361 74652D32 35353133 
  37363430 35308201 22300D06 092A8648 86F70D01 01010500 0382010F 00308201 
  0A028201 0100A823 F14A54A7 6B803A31 EFD04919 69F7F7D8 024D0E46 34A03880 
  56B5B971 D3C8A833 3FF0C2C7 49EF6033 199B2E7B AE4D282A 78A74C1D 55EA6DC9 
  459F84BD 968AD10A 3F923343 310ADDC7 839E4E31 562FF53E 49185F6D 75C67B6D 
  2C755DE9 B8B81D6A 593EC462 409A66A0 4A8957ED 32E5F201 F084E85C ADFAC8F6 
  BDEC3B52 9A4091C9 850B4C88 F8AE4C15 8DF41E2E 47103721 3B853B7C B01BF394 
  D3F86645 7DFC3814 4169727C 1C8BAAFF BC8AE4E1 ED315A9E B46DC213 1A0D09F3 
  67C6D52C 2A965C81 757C28E1 0D201350 D475B40C 4A0C870C 2A6C1184 2990FBB1 
  E3FCB065 3C8D61D6 BDD7C725 919785AE 2A5FD464 FA7E4DF4 2B5BFAD6 CF44BF9C 
  D6C202BB A14D0203 010001A3 53305130 0F060355 1D130101 FF040530 030101FF 
  301F0603 551D2304 18301680 14F96D73 EA9349FD 357AC170 E93BC439 53EFE7B2 
  45301D06 03551D0E 04160414 F96D73EA 9349FD35 7AC170E9 3BC43953 EFE7B245 
  300D0609 2A864886 F70D0101 05050003 82010100 5E88BC48 9C9752AC B983344C 
  FC1FF49C 7B19C714 B88EAA97 412759DE 88082786 16486B69 C03E4005 D86EE45E 
  3B3C6374 82C2F19E FB0FB64A EB5CB4D9 B24502B7 16A3B1A4 5BDC5EC0 341600E1 
  A39A1EBB 4A13852F 4D52B5AC CD4B7353 793BFF0D 1889F3EB 79A1688C D7C659D6 
  F1CC3566 3F44357C FCE836A8 E4696275 979731CC AF46CAB5 8C819878 FE987BA5 
  A3225FF1 B6897CF1 B90FD7A6 5EDDDBDE 1C1F6E0B 5AED1D75 38C52F63 F118CB87 
  F2C3AC34 8161DD1D CE123218 E99D395E D6C5F536 BBC406BF C8F3A39B 50C4AB2F 
  98520757 9E189A44 DCC9B322 40067C65 DE0B4AE0 13113A41 43C37D6E 6BD72E50 
  63FA38F0 8067A968 DABAA14F F2D7D9D0 988BD78B
  	quit
!
!
!
voice class codec 101
 codec preference 1 g711ulaw
!
!
!
!
!
!
!
!
voice-card 0/1
 no watchdog
!
voice-card 0/4
 no watchdog
!
license udi pid ISR4331/K9 sn FDO224000BY
no license smart enable
diagnostic bootup level minimal
!
spanning-tree extend system-id
archive
 log config
  hidekeys
!
!
!
username serg privilege 15 secret 5 $1$5apJ$wkiXgIsQWl2uXBLt/ODhD1
username vlad privilege 15 secret 5 $1$sfAD$Z7CEpAghy5iMCDEmdBteY1
username kost privilege 15 secret 5 $1$lcdi$KK.aE4eBJUnmTkN61PVkN0
!
redundancy
 mode none
!
!
!
!
!
!
track 10 list threshold percentage
 object 11
 object 12
 threshold percentage up 50
!
track 11 ip sla 11 reachability
 default-state up
 delay down 15 up 180
!
track 12 ip sla 12 reachability
 default-state up
 delay down 15 up 180
!
track 21 ip sla 21 reachability
 default-state up
 delay down 30 up 15
!
track 22 ip sla 22 reachability
 default-state up
 delay down 30 up 15
!
!
class-map type inspect match-any DHCP-IN
 match access-group name DHCP-IN
class-map type inspect match-any ALL-PROTO
 match protocol udp
 match protocol tcp
 match protocol icmp
class-map type inspect match-any DMVPN
 match access-group name DMVPN
class-map type inspect match-any TRUSTED-IP
 match access-group name TRUSTED-IP
class-map type inspect match-any PERMIT-ALL
 match access-group name PERMIT-ALL
class-map type inspect match-any DHCP-OUT
 match access-group name DHCP-OUT
!
policy-map type inspect self-OUTSIDE-POLICY
 class type inspect TRUSTED-IP
  pass
 class type inspect DMVPN
  pass
 class type inspect ALL-PROTO
  inspect
 class type inspect DHCP-OUT
  pass
 class class-default
  drop
policy-map type inspect self-INSIDE
 class type inspect PERMIT-ALL
  pass
 class class-default
  drop
policy-map type inspect OUTSIDE-DMZ-POLICY
 class class-default
  drop
policy-map type inspect DMZ-OUTSIDE-POLICY
 class type inspect ALL-PROTO
  inspect
 class class-default
  drop
policy-map type inspect OUTSIDE-self-POLICY
 class type inspect TRUSTED-IP
  pass
 class type inspect DMVPN
  pass
 class type inspect DHCP-IN
  pass
 class class-default
  drop
policy-map type inspect INSIDE-OUTSIDE-POLICY
 class type inspect ALL-PROTO
  inspect
 class class-default
  drop
policy-map type inspect OUTSIDE-INSIDE-POLICY
 class class-default
  drop
policy-map type inspect INSIDE-self
 class type inspect PERMIT-ALL
  pass
 class class-default
  drop
!
zone security OUTSIDE
zone security INSIDE
zone security DMZ
zone-pair security DMZ-OUTSIDE source DMZ destination OUTSIDE
 service-policy type inspect DMZ-OUTSIDE-POLICY
zone-pair security INSIDE-OUTSIDE source INSIDE destination OUTSIDE
 service-policy type inspect INSIDE-OUTSIDE-POLICY
zone-pair security INSIDE-self source INSIDE destination self
 service-policy type inspect INSIDE-self
zone-pair security OUTSIDE-DMZ source OUTSIDE destination DMZ
 service-policy type inspect OUTSIDE-DMZ-POLICY
zone-pair security OUTSIDE-INSIDE source OUTSIDE destination INSIDE
 service-policy type inspect OUTSIDE-INSIDE-POLICY
zone-pair security OUTSIDE-self source OUTSIDE destination self
 service-policy type inspect OUTSIDE-self-POLICY
zone-pair security self-INSIDE source self destination INSIDE
 service-policy type inspect self-INSIDE
zone-pair security self-OUTSIDE source self destination OUTSIDE
 service-policy type inspect self-OUTSIDE-POLICY
! 
!
!
!
!
crypto isakmp policy 10
 encr aes 256
 authentication pre-share
 group 5
 lifetime 3600
crypto isakmp key idapi32.cfg address 0.0.0.0        
crypto isakmp keepalive 10 periodic
!
crypto ipsec security-association idle-time 60
!
crypto ipsec transform-set AES-256 esp-aes 256 esp-sha-hmac 
 mode tunnel
!
crypto ipsec profile DMVPN-1
 set transform-set AES-256 
!
crypto ipsec profile DMVPN-2
 set transform-set AES-256 
!
!
!
!
!
!
! 
! 
!
!
interface Tunnel11
 bandwidth 100000
 ip address 10.10.10.45 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas1
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.10.10.50 95.163.126.10
 ip nhrp network-id 111
 ip nhrp holdtime 300
 ip nhrp nhs 10.10.10.50
 zone-member security INSIDE
 ip tcp adjust-mss 1260
 delay 10000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 111
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel12
 bandwidth 100000
 ip address 10.20.20.45 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas2
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.20.20.50 89.188.102.142
 ip nhrp network-id 222
 ip nhrp holdtime 300
 ip nhrp nhs 10.20.20.50
 zone-member security INSIDE
 ip tcp adjust-mss 1260
 delay 20000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 222
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel21
 bandwidth 4000
 ip address 10.30.30.45 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas3
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.30.30.50 95.163.126.10
 ip nhrp network-id 333
 ip nhrp holdtime 300
 ip nhrp nhs 10.30.30.50
 zone-member security INSIDE
 ip tcp adjust-mss 1260
 delay 30000
 shutdown
 tunnel source GigabitEthernet0/0/2
 tunnel mode gre multipoint
 tunnel key 333
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface Tunnel22
 bandwidth 4000
 ip address 10.40.40.45 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas4
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.40.40.50 89.188.102.142
 ip nhrp network-id 444
 ip nhrp holdtime 300
 ip nhrp nhs 10.40.40.50
 zone-member security INSIDE
 ip tcp adjust-mss 1260
 delay 40000
 shutdown
 tunnel source GigabitEthernet0/0/2
 tunnel mode gre multipoint
 tunnel key 444
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-2 shared
!
interface GigabitEthernet0/0/0
 description INTERNAL
 no ip address
 negotiation auto
!
interface GigabitEthernet0/0/0.40
 description LAN
 encapsulation dot1Q 40
 ip address 192.168.45.250 255.255.255.0
 ip helper-address 192.168.50.10
 zone-member security INSIDE
 ip policy route-map Ent_Inet
!
interface GigabitEthernet0/0/0.80
 description VoIP
 encapsulation dot1Q 80
 ip address 10.80.45.250 255.255.255.0
 zone-member security INSIDE
!
interface GigabitEthernet0/0/0.83
 description SCUD
 encapsulation dot1Q 83
 ip address 10.83.45.250 255.255.255.0
 zone-member security INSIDE
!
interface GigabitEthernet0/0/0.84
 description Gym
 encapsulation dot1Q 84
 ip address 10.84.45.250 255.255.255.0
 ip nat inside
 zone-member security INSIDE
 ip policy route-map NatPartNET
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.85
 description Local_Inet
 encapsulation dot1Q 85
 ip address 10.85.45.250 255.255.255.0
 ip nat inside
 zone-member security DMZ
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.86
 description Videoreg
 encapsulation dot1Q 86
 ip address 10.86.45.250 255.255.255.0
 zone-member security INSIDE
!
interface GigabitEthernet0/0/1
 description I-Techno_prime
 ip address 185.212.88.112 255.255.255.0
 ip nat outside
 zone-member security OUTSIDE
 negotiation auto
!
interface GigabitEthernet0/0/2
 description ITGROUP_back
 ip address 10.100.45.2 255.255.255.252
 zone-member security OUTSIDE
 negotiation auto
!
interface Service-Engine0/1/0
!
interface Service-Engine0/4/0
!
interface GigabitEthernet0
 vrf forwarding Mgmt-intf
 no ip address
 shutdown
 negotiation auto
!
!
router eigrp 1
 network 10.10.10.0 0.0.0.255
 network 10.20.20.0 0.0.0.255
 network 10.30.30.0 0.0.0.255
 network 10.40.40.0 0.0.0.255
 network 10.80.45.0 0.0.0.255
 network 10.83.45.0 0.0.0.255
 network 10.86.45.0 0.0.0.255
 network 192.168.45.0
 passive-interface default
 no passive-interface Tunnel11
 no passive-interface Tunnel12
 no passive-interface Tunnel21
 no passive-interface Tunnel22
 eigrp stub connected summary
!
ip forward-protocol nd
no ip http server
ip http authentication local
no ip http secure-server
ip tftp source-interface GigabitEthernet0/0/0.80
ip nat inside source list NAT-DMZ interface GigabitEthernet0/0/1 overload
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/1 185.212.88.1 10 name ITech_prime track 10
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/2 10.100.45.1 254 name ITGR_backup
ip route 89.188.102.132 255.255.255.255 GigabitEthernet0/0/2 10.100.45.1 10 name SLA_22
ip route 89.188.102.141 255.255.255.255 GigabitEthernet0/0/1 185.212.88.1 10 name SLA_12
ip route 95.163.126.11 255.255.255.255 GigabitEthernet0/0/1 185.212.88.1 10 name SLA_11
ip route 95.163.126.12 255.255.255.255 GigabitEthernet0/0/2 10.100.45.1 10 name SLA_21
!
!
!
ip access-list extended DHCP-IN
 permit udp any any eq bootpc
ip access-list extended DHCP-OUT
 permit udp any any eq bootps
ip access-list extended DMVPN
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
ip access-list extended NAT-DMZ
 permit ip 10.85.0.0 0.0.255.255 any
ip access-list extended NAT-GYM
 permit ip 10.84.0.0 0.0.255.255 any
ip access-list extended PERMIT-ALL
 permit ip any any
ip access-list extended TRUSTED-IP
 permit ip host 95.163.126.10 any
 permit ip host 89.188.102.142 any
 permit ip host 194.186.172.170 any
 permit ip any host 95.163.126.10
 permit ip any host 89.188.102.142
 permit ip any host 194.186.172.170
ip sla 11
 icmp-echo 95.163.126.11 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 11 life forever start-time now
ip sla 12
 icmp-echo 89.188.102.141 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 12 life forever start-time now
ip sla 21
 icmp-echo 95.163.126.12 source-interface GigabitEthernet0/0/2
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 21 life forever start-time now
ip sla 22
 icmp-echo 89.188.102.132 source-interface GigabitEthernet0/0/2
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 22 life forever start-time now
access-list 60 permit 192.168.41.7
access-list 60 permit 192.168.50.128
access-list 60 permit 192.168.50.175
!
!
route-map Ent_Inet permit 10 
 match ip address Ent_Inet
 set ip next-hop 10.10.10.50 10.20.20.50 10.30.30.50
 set ip default next-hop 10.40.40.50
!
snmp-server community c2011r RO 60
snmp-server community c2011w RW 60
snmp-server trap-source GigabitEthernet0/0/0.40
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps config
snmp-server enable traps syslog
snmp-server host 192.168.50.128 c2011w 
snmp ifmib ifindex persist
!
!
!
!
control-plane
!
!
voice-port 0/1/0
!
voice-port 0/1/1
!
voice-port 0/1/2
!
voice-port 0/1/3
!
mgcp behavior rsip-range tgcp-only
mgcp behavior comedia-role none
mgcp behavior comedia-check-media-src disable
mgcp behavior comedia-sdp-force disable
!
mgcp profile default
!
!
!
!
!
banner login ^C
#######################################################
###               Attention!                        ###
###     RFG authorized personnel only.              ###
###     Please enter your username and password.    ###
###     All access will be logged.                  ###
#######################################################
^C
!
line con 0
 exec-timeout 60 0
 transport input none
 stopbits 1
line aux 0
 stopbits 1
line vty 0 4
 exec-timeout 60 0
 logging synchronous
 transport input ssh
line vty 5 15
 exec-timeout 60 0
 logging synchronous
 transport input ssh
!
ntp server 10.10.10.50 prefer
ntp server 10.20.20.50
ntp server 10.30.30.50
ntp server 10.40.40.50
!
!
!
!
event manager applet T11_up
 event track 11 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 no shut"
 action 5.0 cli command "int tun21"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T11_down
 event track 11 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 shut"
 action 5.0 track read 21
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun21"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel21 no shut"
 action 9.3 end
event manager applet T12_up
 event track 12 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 no shut"
 action 5.0 cli command "int tun22"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel22 shut"
event manager applet T12_down
 event track 12 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 shut"
 action 5.0 track read 22
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun22"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel22 no shut"
 action 9.3 end
event manager applet T21_up
 event track 21 state up
 action 1.0 track read 11
 action 2.0 if $_track_state eq "down"
 action 3.0  cli command "en"
 action 4.0  cli command "conf t"
 action 5.0  cli command "int tun21"
 action 6.0  cli command "no shut"
 action 6.1  syslog priority emergencies msg "Tunnel21 no shut"
 action 7.0 end
event manager applet T21_down
 event track 21 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun21"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T22_up
 event track 22 state up
 action 1.0 track read 12
 action 2.0 if $_track_state eq "down"
 action 3.0  cli command "en"
 action 4.0  cli command "conf t"
 action 5.0  cli command "int tun22"
 action 6.0  cli command "no shut"
 action 6.1  syslog priority emergencies msg "Tunnel22 no shut"
 action 7.0 end
event manager applet T22_down
 event track 22 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun22"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel22 shut"
!
end
