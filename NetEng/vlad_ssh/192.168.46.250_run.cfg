Building configuration...


Current configuration : 15242 bytes
!
! Last configuration change at 02:06:19 MSK Wed Jan 15 2020
!
version 16.6
service timestamps debug datetime msec localtime
service timestamps log datetime msec localtime
service password-encryption
platform qfp utilization monitor load 80
no platform punt-keepalive disable-kernel-core
!
hostname soc-sch-rt1
!
boot-start-marker
boot system flash isr4300-universalk9.16.06.06.SPA.bin
boot-end-marker
!
!
vrf definition Mgmt-intf
 !
 address-family ipv4
 exit-address-family
 !
 address-family ipv6
 exit-address-family
!
logging buffered 65536
enable secret 5 $1$oXgI$fBMPGRbSQ2hYtNEPv8B1T/
!
aaa new-model
!
!
aaa authentication login default local
aaa authorization exec default local 
!
!
!
!
!
!
aaa session-id common
clock timezone MSK 3 0
!
no ip domain lookup
ip domain name wcfc.local
ip dhcp database Phone
ip dhcp excluded-address 10.80.46.100 10.80.46.254
ip dhcp excluded-address 10.80.46.1 10.80.46.10
ip dhcp excluded-address 10.84.46.245 10.84.46.255
!
ip dhcp pool Phone
 network 10.80.46.0 255.255.255.0
 option 150 ip 10.80.50.11 
 default-router 10.80.46.250 
!
ip dhcp pool Gym
 network 10.84.46.0 255.255.255.0
 default-router 10.84.46.250 
 dns-server 8.8.8.8 
!
ip dhcp pool Local_Inet
 network 10.85.46.0 255.255.255.0
 default-router 10.85.46.250 
 dns-server 8.8.8.8 
!
ip dhcp pool SCUD
 network 10.83.46.0 255.255.255.0
 default-router 10.83.46.250 
 dns-server 8.8.8.8 
!
!
!
!
!
!
!
!
!
!
subscriber templating
! 
! 
! 
! 
!
!
!
multilink bundle-name authenticated
!
!
!
!
!
key chain Eigrp_pass
 key 1
  key-string 7 0222296459565E7573581917
!
!
!
!
!
!
!
voice service voip
 ip address trusted list
  ipv4 10.80.50.11 255.255.255.255
  ipv4 85.174.190.130 255.255.255.255
 address-hiding
 media disable-detailed-stats
 allow-connections sip to sip
 no supplementary-service sip handle-replaces
 fax protocol t38 version 0 ls-redundancy 0 hs-redundancy 0 fallback none
 sip
  header-passing
  error-passthru
  registrar server
  early-offer forced
  midcall-signaling passthru
!
voice class codec 1
 codec preference 1 g711alaw
 codec preference 2 g711ulaw
 codec preference 3 g729r8
!
!
!
!
!
!
!
!
!
voice-card 0/4
 no watchdog
!
license udi pid ISR4331/K9 sn FDO21412VM8
license accept end user agreement
diagnostic bootup level minimal
spanning-tree extend system-id
!
!
!
username serg privilege 15 secret 5 $1$5apJ$wkiXgIsQWl2uXBLt/ODhD1
username vlad privilege 15 secret 5 $1$sfAD$Z7CEpAghy5iMCDEmdBteY1
username kost privilege 15 secret 5 $1$lcdi$KK.aE4eBJUnmTkN61PVkN0
!
redundancy
 mode none
!
!
!
!
!
!
track 10 list threshold percentage
 object 11
 object 12
 threshold percentage up 50
!
track 11 ip sla 11 reachability
 default-state up
 delay down 15 up 180
!
track 12 ip sla 12 reachability
 default-state up
 delay down 15 up 180
!
track 21 ip sla 21 reachability
 default-state up
 delay down 30 up 15
!
track 22 ip sla 22 reachability
 default-state up
 delay down 30 up 15
!
!
class-map match-any MANAGEMENT
 match protocol telnet
 match protocol ssh
 match protocol snmp
class-map type inspect match-any Out_Inside
 match access-group name Management_In
class-map type inspect match-any Inside_Out
 match protocol icmp
 match protocol tcp
 match protocol udp
 match access-group name Management_Out
class-map match-any VOICE
 match protocol mgcp
 match protocol skinny
 match protocol sip
class-map match-all RTP
 match protocol rtp
class-map type inspect match-any Self-Out
 match access-group name Management_Out
class-map type inspect match-any Out-Self
 match access-group name Management_In
class-map type inspect match-all INSIDE_Self
 match access-group name Self_and_INSIDE
!
policy-map type inspect Self_Out
 class type inspect Self-Out
  pass
 class class-default
policy-map Out-QoS
 class VOICE
  priority 16
 class RTP
  priority 1047
 class MANAGEMENT
  bandwidth 8
 class class-default
  fair-queue
  shape average 10000000   
policy-map type inspect Outside_Inside
 class type inspect Out_Inside
  pass
 class class-default
policy-map type inspect Inside_Outside
 class type inspect Inside_Out
  inspect
 class class-default
policy-map type inspect INSIDE_Self
 class type inspect INSIDE_Self
  inspect
 class class-default
policy-map type inspect Self_INSIDE
 class type inspect INSIDE_Self
  pass
 class class-default
policy-map type inspect Out_Self
 class type inspect Out-Self
  pass
 class class-default
!
! 
!
!
!
!
!
!
crypto isakmp policy 10
 encr aes 256
 authentication pre-share
 group 5
 lifetime 3600
crypto isakmp key idapi32.cfg address 0.0.0.0        
crypto isakmp keepalive 10 periodic
!
crypto ipsec security-association idle-time 60
!
crypto ipsec transform-set AES-256 esp-aes 256 esp-sha-hmac 
 mode tunnel
!
crypto ipsec profile DMVPN-1
 set transform-set AES-256 
!
crypto ipsec profile DMVPN-2
 set transform-set AES-256 
!
!
!
!
!
!
! 
! 
!
!
interface Tunnel11
 bandwidth 100000
 ip address 10.10.10.46 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas1
 ip nhrp map multicast 95.163.126.10
 ip nhrp map 10.10.10.50 95.163.126.10
 ip nhrp network-id 111
 ip nhrp holdtime 300
 ip nhrp nhs 10.10.10.50
 ip tcp adjust-mss 1260
 delay 10000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 111
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel12
 bandwidth 100000
 ip address 10.20.20.46 255.255.255.0
 no ip redirects
 ip mtu 1300
 ip authentication mode eigrp 1 md5
 ip authentication key-chain eigrp 1 Eigrp_pass
 ip nhrp authentication nhrppas2
 ip nhrp map multicast 89.188.102.142
 ip nhrp map 10.20.20.50 89.188.102.142
 ip nhrp network-id 222
 ip nhrp holdtime 300
 ip nhrp nhs 10.20.20.50
 ip tcp adjust-mss 1260
 delay 20000
 tunnel source GigabitEthernet0/0/1
 tunnel mode gre multipoint
 tunnel key 222
 tunnel path-mtu-discovery
 tunnel protection ipsec profile DMVPN-1 shared
!
interface Tunnel21
 no ip address
 shutdown
!
interface Tunnel22
 no ip address
 shutdown
!
interface GigabitEthernet0/0/0
 no ip address
 negotiation auto
!
interface GigabitEthernet0/0/0.40
 description LAN
 encapsulation dot1Q 40
 ip address 192.168.46.250 255.255.255.0
 ip policy route-map Ent_Inet
!
interface GigabitEthernet0/0/0.80
 description VoIP
 encapsulation dot1Q 80
 ip address 10.80.46.250 255.255.255.0
!
interface GigabitEthernet0/0/0.83
 description SCUD
 encapsulation dot1Q 83
 ip address 10.83.46.250 255.255.255.0
!
interface GigabitEthernet0/0/0.84
 description Gym
 encapsulation dot1Q 84
 ip address 10.84.46.250 255.255.255.0
 ip nat inside
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.85
 description Local_Inet
 encapsulation dot1Q 85
 ip address 10.85.46.250 255.255.255.0
 ip nat inside
 ip virtual-reassembly
!
interface GigabitEthernet0/0/0.86
 description Videoreg
 encapsulation dot1Q 86
 ip address 10.86.46.250 255.255.255.0
!
interface GigabitEthernet0/0/0.87
 description Test_Nat
 encapsulation dot1Q 87
 ip address 10.87.46.250 255.255.255.0
 ip nat inside
!
interface GigabitEthernet0/0/1
 description Rostelecom
 ip address 85.172.64.186 255.255.255.248
 ip nat outside
 negotiation auto
!
interface GigabitEthernet0/0/2
 no ip address
 shutdown
 negotiation auto
!
interface Service-Engine0/4/0
!
interface GigabitEthernet0
 vrf forwarding Mgmt-intf
 no ip address
 shutdown
 negotiation auto
!
!
router eigrp 1
 network 10.10.10.0 0.0.0.255
 network 10.20.20.0 0.0.0.255
 network 10.30.30.0 0.0.0.255
 network 10.40.40.0 0.0.0.255
 network 10.80.46.0 0.0.0.255
 network 10.83.46.0 0.0.0.255
 network 10.86.46.0 0.0.0.255
 network 10.87.46.0 0.0.0.255
 network 192.168.46.0
 passive-interface default
 no passive-interface Tunnel11
 no passive-interface Tunnel12
 eigrp stub connected summary
!
ip nat inside source static tcp 10.87.46.1 3389 85.172.64.186 3389 extendable
ip nat inside source static tcp 10.87.46.2 7724 85.172.64.186 7724 extendable
ip nat inside source list Nat_Local_Inet interface GigabitEthernet0/0/1 overload
ip forward-protocol nd
no ip http server
no ip http secure-server
ip tftp source-interface GigabitEthernet0/0/0.80
ip route 0.0.0.0 0.0.0.0 GigabitEthernet0/0/1 85.172.64.185 10 name Rostel track 10
ip route 89.188.102.141 255.255.255.255 GigabitEthernet0/0/1 85.172.64.185 10
ip route 95.163.126.11 255.255.255.255 GigabitEthernet0/0/1 85.172.64.185 10
!
!
!
ip access-list extended Ent_Inet
 deny   ip host 192.168.46.99 any
 deny   ip any 10.0.0.0 0.255.255.255
 deny   ip any 172.16.0.0 0.15.255.255
 deny   ip any 192.168.0.0 0.0.255.255
 permit ip any any
ip access-list extended Management_In
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
 permit ip host 89.207.94.167 any
 permit gre host 77.95.130.78 any
 permit ip host 185.79.237.102 any
 permit icmp any any
 permit gre any any
 permit ip host 89.207.94.135 any
 permit gre host 185.8.62.249 any
 permit ip host 185.8.62.249 any
 permit tcp any host 85.172.64.186 eq 7724
 permit udp any host 85.172.64.186 eq 7724
ip access-list extended Management_Out
 permit udp any any eq non500-isakmp
 permit udp any any eq isakmp
 permit esp any any
 permit ip any host 89.207.94.167
 permit gre any host 77.95.130.78
 permit ip any host 185.79.237.102
 permit icmp any any
 permit ip any host 89.207.94.135
 permit gre any any
 permit gre any host 185.8.62.249
 permit ip any host 185.8.62.249
ip access-list extended Nat_Local_Inet
 deny   ip 10.85.0.0 0.0.255.255 10.0.0.0 0.255.255.255
 deny   ip 10.85.0.0 0.0.255.255 172.16.0.0 0.0.31.255
 deny   ip 10.85.0.0 0.0.255.255 192.168.0.0 0.0.255.255
 permit ip 10.84.0.0 0.0.255.255 any
 permit ip 10.85.0.0 0.0.255.255 any
 permit gre 10.85.0.0 0.0.255.255 any
 permit ip 10.87.0.0 0.0.255.255 any
ip access-list extended Out_Local_Inet
 deny   ip 10.85.0.0 0.0.255.255 10.0.0.0 0.255.255.255
 deny   ip 10.85.0.0 0.0.255.255 172.16.0.0 0.0.31.255
 deny   ip 10.85.0.0 0.0.255.255 192.168.0.0 0.0.255.255
 permit ip 10.85.0.0 0.0.255.255 any
 permit udp any any eq bootps
 permit gre 10.85.0.0 0.0.255.255 any
ip access-list extended Self_and_INSIDE
 permit ip any any
ip access-list extended sip-cucm
 permit ip host 10.80.46.250 any
 permit ip any host 10.80.46.250
ip access-list extended sip-traffic
 permit ip host 85.174.190.130 any
 permit ip any host 85.174.190.130
ip sla 11
 icmp-echo 95.163.126.11 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 11 life forever start-time now
ip sla 12
 icmp-echo 89.188.102.141 source-interface GigabitEthernet0/0/1
 request-data-size 1000
 threshold 200
 timeout 300
 frequency 4
ip sla schedule 12 life forever start-time now
access-list 60 permit 192.168.50.128
access-list 60 permit 192.168.50.175
!
!
route-map Ent_Inet permit 10 
 match ip address Ent_Inet
 set ip next-hop 10.10.10.50 10.20.20.50 10.30.30.50
 set ip default next-hop 10.40.40.50
!
snmp-server community c2011r RO 60
snmp-server community c2011w RW 60
snmp-server trap-source GigabitEthernet0/0/0.40
snmp-server enable traps snmp authentication linkdown linkup coldstart warmstart
snmp-server enable traps config
snmp-server enable traps syslog
snmp-server host 192.168.50.128 c2011w 
snmp ifmib ifindex persist
!
!
!
!
control-plane
!
!
mgcp behavior rsip-range tgcp-only
mgcp behavior comedia-role none
mgcp behavior comedia-check-media-src disable
mgcp behavior comedia-sdp-force disable
!
mgcp profile default
!
!
!
!
dial-peer voice 10 voip
 description Out_Rost
 destination-pattern 8..........
 session protocol sipv2
 session target sip-server
 voice-class codec 1  
 voice-class sip bind control source-interface GigabitEthernet0/0/1
 voice-class sip bind media source-interface GigabitEthernet0/0/1
 no vad
!
dial-peer voice 11 voip
 description In_Rost
 session protocol sipv2
 session target sip-server
 incoming called-number 8622665501
 voice-class codec 1  
 voice-class sip bind control source-interface GigabitEthernet0/0/1
 voice-class sip bind media source-interface GigabitEthernet0/0/1
 dtmf-relay rtp-nte digit-drop
 no vad
!
dial-peer voice 20 voip
 description Out_CUCM
 destination-pattern 8622665501
 session protocol sipv2
 session target ipv4:10.80.50.11
 voice-class codec 1  
 voice-class sip bind control source-interface GigabitEthernet0/0/0.80
 voice-class sip bind media source-interface GigabitEthernet0/0/0.80
 dtmf-relay rtp-nte digit-drop
 ip qos dscp cs3 signaling
 no vad
!
dial-peer voice 21 voip
 description In_CUCM
 session protocol sipv2
 session target sip-server
 incoming called-number 8..........
 voice-class codec 1  
 voice-class sip bind control source-interface GigabitEthernet0/0/0.80
 voice-class sip bind media source-interface GigabitEthernet0/0/0.80
 dtmf-relay rtp-nte digit-drop
 no vad
!
!
sip-ua 
 credentials username 8622665501 password 7 120F573D45061D573E09 realm 2000
 authentication username 8622665501 password 7 131345385C0115793F06
 calling-info pstn-to-sip from number set 8622665501
 registrar ipv4:85.174.190.130:5060 expires 600
 sip-server ipv4:85.174.190.130
!
!
line con 0
 exec-timeout 60 0
 transport input none
 stopbits 1
line aux 0
 stopbits 1
line vty 0 4
 exec-timeout 60 0
 logging synchronous
 transport input ssh
line vty 5 15
 exec-timeout 60 0
 logging synchronous
 transport input ssh
!
ntp server 10.100.50.18
ntp server 10.100.50.14 prefer
!
!
!
!
event manager applet T11_up
 event track 11 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 no shut"
 action 5.0 cli command "int tun21"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel21 shut"
event manager applet T11_down
 event track 11 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun11"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel11 shut"
 action 5.0 track read 21
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun21"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel21 no shut"
 action 9.3 end
event manager applet T12_up
 event track 12 state up
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "no shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 no shut"
 action 5.0 cli command "int tun22"
 action 6.0 cli command "shut"
 action 6.1 syslog priority emergencies msg "Tunnel22 shut"
event manager applet T12_down
 event track 12 state down
 action 1.0 cli command "en"
 action 2.0 cli command "conf t"
 action 3.0 cli command "int tun12"
 action 4.0 cli command "shut"
 action 4.1 syslog priority emergencies msg "Tunnel12 shut"
 action 5.0 track read 22
 action 6.0 if $_track_state eq "up"
 action 7.0  cli command "en"
 action 8.0  cli command "conf t"
 action 9.0  cli command "int tun22"
 action 9.1  cli command "no shut"
 action 9.2  syslog priority emergencies msg "Tunnel22 no shut"
 action 9.3 end
!
end
